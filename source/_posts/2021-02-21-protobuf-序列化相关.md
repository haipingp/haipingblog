---
title: protobuf-序列化相关
date: 2021-02-21 23:40:00
categories:
- C++
---

## 一、`ByteSize`接口的使用
* 之前搜`GetCachedSize`的使用方法时，搜到这个相关的一个问题:`https://groups.google.com/g/protobuf/c/wtFmdPWvPHM?pli=1`(如何防止重复计算序列化所需的大小)

<!--more-->

* `GetCachedSize()`返回的是`ByteSize()`之后保存的值，如果调用`GetCachedSize`之前没有调用过`ByteSize()`，返回0
* 有两种方法可以避免重复调用`ByteSize()`：
    1. 先调用`ByteSize()`，并保存调用结果，再调用`SerializeWithCachedSizesToArray()`，该序列化接口将使用保存的序列化所需大小，而无须重复计算
    2. 先调用`SerializeToArray()`，如果成功的话，再调用`GetCachedSize()`查看序列化写入了多少字节
![序列化相关的一个问题](aboutSerializeToArray.png)
