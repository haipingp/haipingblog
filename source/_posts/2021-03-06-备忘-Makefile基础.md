---
title: 备忘-Makefile基础
date: 2021-03-06 21:17:25
categories: C++
---

## 一、Makefile基础
* Makefile中的规则语法一般这样:
``` MAKEFILE
target ... : prerequisites ...
    command
    ...
    ...
```

* `$^`和`$@`分别表示依赖部分、目标部分

## 二、Makefile中的.d文件
### 2.1 简介
* Makefile有个隐晦规则，`.o`文件会自动查找同名的`.c`文件。比如有两个文件`first.c`，`main.c`，Makefile可以这样写:
``` make
OBJS:=first.o main.o
main:$(OBJS)
	gcc -o main $^
```
隐晦规则中，会加入`gcc -c *.c`，所以上面的Makefile可以工作。但是这种规则下，因为规则中没有写头文件，因此即使头文件修改了，也不会重新编译。所以写比较简单的make语句时，还是建议将头文件加进去。

* 那么有什么简单的方法在规则中加入头文件呢，`gcc -MM first.c`可以输出`first.o : first.c *.h `。因此可以把每个源文件`gcc -MM`到`.d`文件中，并在Makefile中include进来，相当于把这种依赖规则包含进来了，头文件变化的时候，头文件时间戳变化，Makefile会重新编译目标文件。

### 2.2 例子

